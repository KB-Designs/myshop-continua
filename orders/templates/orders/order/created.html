{% extends "shop/base.html" %}

{% block title %}
  Thank You
{% endblock %}

{% block content %}
  <div class="max-w-2xl mx-auto text-center py-10">
    <h1 class="text-3xl font-bold text-green-600 mb-4">Thank You!</h1>
    <p class="text-lg text-gray-700 mb-2">Your order has been placed successfully.</p>
    <p class="text-gray-700 mb-6">
      Your order number is 
      <strong class="text-black">#{{ order.id }}</strong>.
    </p>

    <p class="text-gray-600 mb-6">
      If you selected <span class="font-semibold">M-Pesa</span> as your payment method, 
      check your phone for an STK push request to complete the payment.
    </p>

    <!-- ✅ Payment status -->
    {% if order.payment_status == 'Paid' %}
      <p class="text-green-600 font-semibold mb-6">
        ✅ Payment Successful (Receipt: {{ order.payment_reference }})
      </p>
      <script>
        setTimeout(() => {
          window.location.href = "{% url 'shop:product_list' %}";
        }, 5000);
      </script>

    {% elif order.payment_status == 'Failed' %}
      <p class="text-red-600 font-semibold mb-6">❌ Payment Failed</p>

    {% else %}
      <p class="text-orange-500 font-semibold mb-4">⌛ Payment Pending</p>

      <!-- Refresh Button -->
      <button id="refresh-btn" 
        class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded transition"
        onclick="refreshPage()">
        🔄 Refresh Payment Status
      </button>

      <!-- Spinner -->
      <div id="spinner" class="mt-4 hidden">
        <div class="w-6 h-6 border-4 border-gray-200 border-t-blue-500 rounded-full animate-spin mx-auto"></div>
        <p class="text-gray-500 text-sm mt-2">Checking payment status...</p>
      </div>
    {% endif %}

    <div class="mt-8">
      <a href="{% url 'shop:product_list' %}" class="text-blue-500 hover:underline">
        ← Back to Shopping
      </a>
    </div>
  </div>

  <!-- JS -->
  <script>
    function refreshPage() {
      document.getElementById("spinner").classList.remove("hidden");
      document.getElementById("refresh-btn").disabled = true;
      setTimeout(() => {
        location.reload();
      }, 1500);
    }
  </script>
{% endblock %}
